<!DOCTYPE html>
<html lan g=" en ">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Management System</title>
    <script src="assets/js/tailwind.js"></script>
    <script src="assets/js/jquery.js"></script>


</head>

<body>

    <div class=" p-12 gap-6 ">

        <div class="bg-gray-600 p-4 float-left rounded shadow w-6/12 text-white">

            <table class="w-full">
                <thead>
                    <tr class="bg-gray-800 shadow-md text-left ">
                        <th class="p-2 ">#</th>
                        <th class="p-2 ">Name</th>
                        <th class="p-2 ">Qty</th>
                        <th class="p-2 ">Price</th>
                        <th class="p-2 ">Total</th>
                        <th class="p-2 text-center">Action</th>

                    </tr>
                </thead>

                <tbody id="tableBody">
                </tbody>

            </table>
            <div class="flex justify-end">
                <input type="text" id="discount" class="p-2 text-white bg-transparent w-2/12 text-right text-xl px-8 "
                    placeholder="Discount (%)" />
            </div>
            <div class="flex justify-between w-full ">

                <div class="float-right  bg-gray-800 w-full  p-1 font-bold text-xl">SubTotal: <span id="subtotal"
                        class="float-right">
                    </span></div>
            </div>
            <div class="flex justify-end">
                <div class="float-right  bg-gray-800 p-1 w-full font-bold text-xl">Discount Amount:
                    <span id="discountamount" class="float-right">
                    </span>
                </div>
            </div>

            <div class="flex justify-end">
                <div class="float-right  bg-gray-800 p-1 w-full font-bold text-xl">Net Total: <span id="total"
                        class="float-right">
                    </span></div>
            </div>


            <div class="bg-gray-700 p-6 flex justify-between  ">
                <button class="bg-red-500 px-12 rounded py-3 shadow" id="resetBtn">Reset</button>
                <button class="bg-green-600 text-white py-3 px-12 rounded shadow" id="confirmOrder">Confirm
                    Order</button>

            </div>

        </div>

        <div id="parentDiv" class="bg-gray-200 p-4 w-6/12  rounded shadow text-center grid grid-cols-3 gap-4">
        </div>
    </div>


    <script>


        var username = "SAGHEER";

        document.cookie = "username=" + username;


        $(document).ready(function () {

            var order_items = [];
            var items = [
                {
                    name: "Biryani",
                    price: 200,
                    image: "biryani.jpg",
                },
                {
                    name: "Karhai",
                    price: 400,
                    image: "karhai.jpg",
                },
                {
                    name: "Qorma",
                    price: 600,
                    image: "qorma.jpg",
                },
            ];
            var order = [];

            updateItems();
            setUpItemClickListener();

            async function updateItems() {


                //foreach on items

                await items.forEach(function (item) {

                    var itemDiv = `
                <div class="p-4 item cursor-pointer transform hover:scale-105 duration-500 rounded shadow bg-white">
                <img src="assets/images/${item.image}" class="rounded-md" alt="" srcset="">
                <div class="flex justify-between">
                    <h1 class="mt-4 text-xl font-bold" id="name">${item.name}</h1>
                    <h1 class="mt-4 text-xl text-gray-400 font-bold" id="price" data-price="${item.price}">Rs.${item.price}</h1>
                </div>
            </div>
                `;
                    $("#parentDiv").append(itemDiv);

                });


                $('#discount').change(function () {
                    calculateTotalWithDiscount();
                });
            }

            function setUpItemClickListener() {
                $('.item').click(function () {

                    var item_name = $(this).find('#name').text();
                    var item_price = $(this).find('#price').data('price');

                    var item_exists = checkIfItemExists(item_name);

                    if (item_exists) {
                        order_items.forEach(function (item) {
                            if (item.name === item_name) {
                                updateOrderItems(item.name, item.qty + 1);
                            }
                        });
                    } else {
                        addItemToOrderItems(item_name, item_price);

                        $('#qty_' + item_name).change(function () {
                            var qty = $(this).val();
                            updateOrderItems(item_name, qty);
                            calculateTotalWithDiscount();
                        });
                    }
                    calculateTotalWithDiscount();
                });
            }

            function calculateTotalWithDiscount() {
                var dic_per = $('#discount').val() || 0;
                var total = 0;
                order_items.forEach(item => {
                    total += item.total;
                });

                $("#subtotal").html("Rs." + total);
                var discount = total * dic_per / 100;
                $("#discountamount").html("Rs." + discount);
                $("#total").html("Rs." + (total - discount));
            }

            function updateOrderItems(item_name, qty) {
                order_items.forEach(function (item) {
                    if (item.name == item_name) {
                        item.qty = qty;
                        item.total = item.qty * item.price;
                        var currentItemSelected = $('#item_' + item_name);
                        currentItemSelected.children()[2].children[0].value = item.qty;
                        currentItemSelected.children()[4].innerHTML = "Rs." + item.total;
                    }
                });
            }

            function addItemToTableBody(item) {
                var tableBody = $("#tableBody");

                var tableRow = `<tr class="bg-gray-500" id="item_${item.name}">
                        <td class="p-2">1</td>
                        <td class="p-2">${item.name}</td>
                        <td class="p-2">
                            <input type="number" id="qty_${item.name}" class="border-2  p-1 bg-transparent" value="1" size="5" min="1" max="5">
                        </td>
                        <td class="p-2">Rs.${item.price}</td>
                        <td class="p-2">Rs.${item.price}</td>
                        <td class="p-2 text-center"><button id="item_del_${item.name}" class="bg-red-500 text-white rounded-md shadow px-4 py-1">Delete</button></td>
                    </tr>`;



                tableBody.append(tableRow);

                $('#item_del_' + item.name).click(function () {
                    $('#item_' + item.name).remove();

                    order_items.forEach(function (itemm, index) {
                        if (itemm.name == item.name) {
                            order_items.splice(index, 1);
                        }
                    });

                    calculateTotalWithDiscount();
                });
            }

            function addItemToOrderItems(item_name, item_price) {
                itemObj = {
                    name: item_name,
                    price: item_price,
                    qty: 1,
                    total: item_price,
                };

                order_items.push(itemObj);

                addItemToTableBody(itemObj);

            }

            function checkIfItemExists(item_name) {
                var item_exists = false;
                order_items.forEach(function (item) {
                    if (item.name == item_name) {
                        item_exists = true;
                    }
                });
                return item_exists;
            }

            $('#resetBtn').click(function () {
                order_items = [];
                calculateTotalWithDiscount();
                $('#tableBody').empty();
                $('#discount').val(0);

            });

            $('#confirmOrder').click(function () {

                var discount = $('#discount').val();
                order.push(order_items);
                order.push(discount);

            });

        });


    </script>
</body>

</html>