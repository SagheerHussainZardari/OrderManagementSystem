<!DOCTYPE html>
<html lan g=" en ">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Management System</title>
    <script src="assets/js/tailwind.js"></script>
    <script src="assets/js/jquery.js"></script>


</head>

<body>

    <div class=" p-12 gap-6 grid grid-cols-2">

        <div class="bg-gray-600 p-4 rounded shadow text-white">

            <table class="w-full">
                <thead>
                    <tr class="bg-gray-800 shadow-md  ">
                        <th class="p-2 ">#</th>
                        <th class="p-2 ">Name</th>
                        <th class="p-2 ">Qty</th>
                        <th class="p-2 ">Price</th>
                        <th class="p-2 ">Total</th>
                    </tr>
                </thead>

                <tbody id="tableBody">
                </tbody>

            </table>
            <div class="flex flex-col">
                <input type="number" id="dicount" class="p-1 text-black" placeholder="Discount (%)" />
                <div class="float-right  bg-gray-800 p-1 font-bold text-xl" id="subtotal">SubTotal: Rs.0</div>
                <div class="float-right  bg-gray-800 p-1 font-bold text-xl" id="discountamount">Discount Amount:
                    Rs.0
                </div>
                <div class="float-right  bg-gray-800 p-1 font-bold text-xl" id="total">Net Total: Rs.0</div>
            </div>

        </div>

        <div id="parentDiv" class="bg-gray-200 p-4  rounded shadow text-center grid grid-cols-3 gap-4">
        </div>
    </div>


    <script>

        $(document).ready(function () {

            var order_items = [];
            var items = [
                {
                    name: "Biryani",
                    price: 200,
                    image: "biryani.jpg",
                },
                {
                    name: "Karhai",
                    price: 400,
                    image: "karhai.jpg",
                },
                {
                    name: "Qorma",
                    price: 600,
                    image: "qorma.jpg",
                },
            ];

            updateItems();
            setUpItemClickListener();

            async function updateItems() {


                //foreach on items

                await items.forEach(function (item) {

                    var itemDiv = `
                <div class="p-4 item cursor-pointer transform hover:scale-105 duration-500 rounded shadow bg-white">
                <img src="assets/images/${item.image}" class="rounded-md" alt="" srcset="">
                <div class="flex justify-between">
                    <h1 class="mt-4 text-xl font-bold" id="name">${item.name}</h1>
                    <h1 class="mt-4 text-xl text-gray-400 font-bold" id="price" data-price="${item.price}">Rs.${item.price}</h1>
                </div>
            </div>
                `;
                    $("#parentDiv").append(itemDiv);

                });


                $('#dicount').change(function () {
                    calculateTotalWithDiscount();
                });
            }

            function setUpItemClickListener() {
                $('.item').click(function () {

                    var item_name = $(this).find('#name').text();
                    var item_price = $(this).find('#price').data('price');

                    var item_exists = checkIfItemExists(item_name);

                    if (item_exists) {
                        order_items.forEach(function (item) {
                            if (item.name === item_name) {
                                updateOrderItems(item.name, item.qty + 1);
                            }
                        });
                    } else {
                        addItemToOrderItems(item_name, item_price);

                        $('#qty_' + item_name).change(function () {
                            var qty = $(this).val();
                            updateOrderItems(item_name, qty);
                            calculateTotalWithDiscount();
                        });
                    }
                    calculateTotalWithDiscount();
                });
            }

            function calculateTotalWithDiscount() {
                var dic_per = $('#dicount').val() || 0;
                var total = 0;
                order_items.forEach(item => {
                    total += item.total;
                });

                $("#subtotal").html("Sub Total: Rs." + total);
                var discount = total * dic_per / 100;
                $("#discountamount").html("Discount Amount: Rs." + discount);
                $("#total").html("Net Total: Rs." + (total - discount));
            }

            function updateOrderItems(item_name, qty) {
                order_items.forEach(function (item) {
                    if (item.name == item_name) {
                        item.qty = qty;
                        item.total = item.qty * item.price;
                        var currentItemSelected = $('#item_' + item_name);
                        currentItemSelected.children()[2].children[0].value = item.qty;
                        currentItemSelected.children()[4].innerHTML = "Rs." + item.total;
                    }
                });
            }

            function addItemToTableBody(item) {
                var tableBody = $("#tableBody");

                var tableRow = `<tr class="bg-gray-500" id="item_${item.name}">
                        <th class="p-2">1</th>
                        <th class="p-2">${item.name}</th>
                        <th class="p-2">
                            <input type="number" id="qty_${item.name}" class="border-2  p-1 bg-transparent" value="1" size="5" min="1" max="5">
                        </th>
                        <th class="p-2">Rs.${item.price}</th>
                        <th class="p-2">Rs.${item.price}</th>
                    </tr>`;

                tableBody.append(tableRow);
            }

            function addItemToOrderItems(item_name, item_price) {
                itemObj = {
                    name: item_name,
                    price: item_price,
                    qty: 1,
                    total: item_price,
                };

                order_items.push(itemObj);

                addItemToTableBody(itemObj);

            }

            function checkIfItemExists(item_name) {
                var item_exists = false;
                order_items.forEach(function (item) {
                    if (item.name == item_name) {
                        item_exists = true;
                    }
                });
                return item_exists;
            }
        });
    </script>
</body>

</html>